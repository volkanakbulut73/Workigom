// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  INDIVIDUAL  // Job seeker / Donor receiver
  CORPORATE   // Employer / Donor provider
  ADMIN
}

enum ApplicationStatus {
  PENDING
  ASSIGNED
  COMPLETED
  REJECTED
}

enum JobStatus {
  ACTIVE
  PENDING
  REJECTED
  COMPLETED
  CLOSED
}

enum JobUrgency {
  HIGH
  MEDIUM
  LOW
}

enum DonationStatus {
  AVAILABLE
  RESERVED
  COMPLETED
  CANCELLED
}

enum FoodType {
  COOKED_MEAL
  PACKAGED_FOOD
  FRESH_PRODUCE
  BAKERY
  DAIRY
  OTHER
}

enum NotificationType {
  JOB_APPLICATION
  JOB_ASSIGNMENT
  DONATION_REQUEST
  DONATION_APPROVED
  MESSAGE
  SYSTEM
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  password      String
  name          String
  phone         String?
  role          UserRole @default(INDIVIDUAL)
  avatar        String?
  isVerified    Boolean  @default(false)
  verifyToken   String?
  resetToken    String?
  resetTokenExp DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  jobsPosted         Job[]           @relation("JobEmployer")
  applications       Application[]
  donationsGiven     Donation[]      @relation("DonationDonor")
  donationsReceived  Donation[]      @relation("DonationReceiver")
  messagesSent       Message[]       @relation("MessageSender")
  messagesReceived   Message[]       @relation("MessageReceiver")
  notifications      Notification[]

  @@map("users")
}

model Job {
  id          String      @id @default(cuid())
  title       String
  description String
  company     String
  location    String
  salary      Float?
  hourlyRate  Float?
  duration    String?
  type        String      // full-time, part-time, contract, temporary
  status      JobStatus   @default(PENDING)
  urgency     JobUrgency  @default(MEDIUM)
  isUrgent    Boolean     @default(false)
  category    String?
  requirements String[]
  startTime   DateTime?
  approvedAt  DateTime?
  employerId  String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  employer     User          @relation("JobEmployer", fields: [employerId], references: [id], onDelete: Cascade)
  applications Application[]

  @@index([employerId])
  @@index([status])
  @@index([isUrgent])
  @@map("jobs")
}

model Application {
  id          String            @id @default(cuid())
  jobId       String
  userId      String
  status      ApplicationStatus @default(PENDING)
  coverLetter String?
  resume      String?           // File path to uploaded resume
  appliedAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  // Relations
  job  Job  @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([jobId, userId])
  @@index([jobId])
  @@index([userId])
  @@index([status])
  @@map("applications")
}

model Donation {
  id          String         @id @default(cuid())
  title       String
  description String
  foodType    FoodType
  quantity    String
  location    String
  address     String?
  status      DonationStatus @default(AVAILABLE)
  expiryDate  DateTime?
  donorId     String
  receiverId  String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  // Relations
  donor    User  @relation("DonationDonor", fields: [donorId], references: [id], onDelete: Cascade)
  receiver User? @relation("DonationReceiver", fields: [receiverId], references: [id], onDelete: SetNull)

  @@index([donorId])
  @@index([receiverId])
  @@index([status])
  @@map("donations")
}

model Message {
  id         String   @id @default(cuid())
  senderId   String
  receiverId String
  content    String
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())

  // Relations
  sender   User @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([isRead])
  @@map("messages")
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  type      NotificationType
  title     String
  content   String
  isRead    Boolean          @default(false)
  link      String?
  createdAt DateTime         @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@map("notifications")
}
